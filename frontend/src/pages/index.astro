---
import Base from "../layouts/Base.astro";
import { getPosts } from "../lib/cms";

const posts = await getPosts(3);
---

<Base title="Stitchline Studio" description="Headless WPGraphQL + Supabase starter">
  <section class="grid gap-10 lg:grid-cols-[1.1fr_0.9fr] items-center">
    <div class="space-y-6 fade-rise">
      <p class="stitch-tag">MONOREPO STACK</p>
      <h1 class="text-4xl sm:text-5xl font-semibold leading-tight">
        Editorial-grade headless sites, stitched with WordPress + Supabase.
      </h1>
      <p class="text-lg text-black/70 max-w-xl">
        Astro delivers the front door. WPGraphQL drives content. Supabase powers auth,
        storage, and APIs without crossing streams.
      </p>
      <div class="flex flex-wrap gap-3">
        <a
          class="stitch-card px-5 py-3 inline-flex items-center gap-2 text-sm font-semibold"
          href="/blog"
        >
          Browse the blog
        </a>
        <a class="text-sm font-semibold" href="/wp-admin" rel="nofollow">
          Open WordPress admin
        </a>
      </div>
    </div>

    <div class="stitch-card p-6 space-y-5 fade-rise">
      <div class="flex items-center justify-between">
        <span class="stitch-tag">LIVE ROUTES</span>
        <span class="text-sm text-black/60">Edge: localhost:8080</span>
      </div>
      <div class="space-y-4">
        <div class="p-4 rounded-2xl bg-white shadow-sm">
          <p class="text-sm uppercase tracking-[0.2em] text-black/50">Astro</p>
          <p class="text-xl font-semibold">/</p>
        </div>
        <div class="p-4 rounded-2xl bg-white shadow-sm">
          <p class="text-sm uppercase tracking-[0.2em] text-black/50">WPGraphQL</p>
          <p class="text-xl font-semibold">/graphql</p>
        </div>
      </div>
      <p class="text-sm text-black/60">
        Supabase runs on its own ports. Kong: localhost:54321, Studio: localhost:54323.
      </p>
    </div>
  </section>

  <section class="mt-16 grid gap-6 md:grid-cols-3">
    <div class="stitch-card p-6 space-y-3 fade-rise">
      <p class="text-lg font-semibold">WordPress stays native</p>
      <p class="text-sm text-black/70">
        MariaDB keeps WP in its comfort zone while GraphQL exposes exactly what Astro needs.
      </p>
    </div>
    <div class="stitch-card p-6 space-y-3 fade-rise" style="animation-delay: 0.1s;">
      <p class="text-lg font-semibold">Supabase runs parallel</p>
      <p class="text-sm text-black/70">
        Auth, storage, and realtime APIs live on Postgres without touching WP data.
      </p>
    </div>
    <div class="stitch-card p-6 space-y-3 fade-rise" style="animation-delay: 0.2s;">
      <p class="text-lg font-semibold">One edge, clean routes</p>
      <p class="text-sm text-black/70">
        Nginx directs Astro and WP traffic. Supabase remains directly exposed.
      </p>
    </div>
  </section>

  <section class="mt-20 space-y-6">
    <div class="flex items-center justify-between">
      <h2 class="text-2xl font-semibold">Latest posts</h2>
      <a class="text-sm font-semibold" href="/blog">View all</a>
    </div>
    {posts.length === 0 ? (
      <div class="stitch-card p-6 text-sm text-black/60">
        No posts yet. Create one in WordPress and it will appear here instantly.
      </div>
    ) : (
      <div class="grid gap-6 md:grid-cols-3">
        {posts.map((post, index) => (
          <a
            class="stitch-card p-6 space-y-3 fade-rise"
            style={`animation-delay: ${index * 0.1}s;`}
            href={`/blog/${post.slug}`}
          >
            <p class="text-sm text-black/50">{post.date?.slice(0, 10)}</p>
            <h3 class="text-lg font-semibold">{post.title}</h3>
            {post.excerpt ? (
              <div class="text-sm text-black/70" set:html={post.excerpt} />
            ) : (
              <p class="text-sm text-black/70">Read the full story.</p>
            )}
          </a>
        ))}
      </div>
    )}
  </section>
</Base>
